#Маршрутлаш
##(Go RabbitMQ клиентини қўллаган ҳолда)
Аввалги қўлланмада биз соддагина қайдловчи тизимни қурдик. Биз қайд ҳабарларини бир қанча қабул қилувчиларга трансляция қилишга қодир эдик.

Ушбу қўлланмада биз унга қўшимча имконият қўшишга яъни биз уни фақат қисм тўпламдаги ҳабарларга ёзилишга имкон берадиган қилишга отланаябмиз. Масалан, биз фақат критик хатоларни қайд файлига (диск сақлаш жойига) йўналтиришимиз мумкин бўлади. Хозирда ҳамма қайд ҳабарлар консолга чоп этилаябди.

#Боғланишлар (bindings)
Аввалги мисолда биз боғланишларни яратгандик.  Сиз кодни ёдга солишингиз мумкин:

```
err = ch.QueueBind(
  q.Name, // queue name
  "",     // routing key
  "logs", // exchange
  false,
  nil)
```
binding бу exchange ва queue орасидаги ўзаро боғловчи. Бу қуйидагича ўқилиши ҳам мумкин: ушбу exchange даги ҳабарларга навбат қизиқаябди.

Binding лар қўшимча routing_key параметрларни қабул қилиши мумкин. Channel.Publish  параметри билан чалкашиш бўлмаслиги сабабли биз уни binding key деб номлаймиз. Қуйида биз боғланишни калит билан қандай яратишимиз кўрсатилган:

```
err = ch.QueueBind(
  q.Name,    // queue name
  "black",   // routing key
  "logs",    // exchange
  false,
  nil)
```
binding key маъноси exchange турига боғлиқ. fanout exchange да ушбу қиймат ташлаб кетилади.

#Exchange ни йўналтириш
Бизнинг аввалги қўлланмада яратган қайдлаш тизимимиз ҳамма ҳабарларни ҳамма қабул қилувчиларга трансляция қилади. Биз уни кенгайтирмоқчимиз, яъни ҳабарларни уларнинг муҳимлигига қараб саралаш имконини қўшмоқчимиз. Масалан, биз қайд ҳабарларидан фақат критик хатолиларини дискка ёзадиган қилишимиз ва ортиқча эслатмали ҳабарлар билан дискни тўлдирмайдиган қилишимиз мумкин.

Биз қўллаган fanout exchange кўп ҳам мослашувчан эмас бўлиб, у фақат ўйламасдан трансляция қилишгагина қодир.

Биз уни ўрнига direct exchange ни қўллаймиз. direct exchange  алгоритми жуда содда бўлиб, у ҳабарларни уларнинг routing key ига  навбатларнинг binding key (боғланиш калити) аниқ мос келсагина маршрутлайди.

Буни иллюстрация қилиш учун навбатдаги созлашни кўриб чиқамиз:

![](4.1.png)

Бу созлашда кўриб турганингиздек биз X  direct exchange иккита навбат билан боғланган. Биринчи навбат orange  номли binding key билан боғланган. Иккинчи навбат эса иккита боғланиш билан боғланган: биринчисининг binding key номи black ва иккинчисиники эса green. 

Бу созлашда ҳабар exchange га orange номли routing key билан нашр қилинган бўлиб, у Q1 навбатга маршрутланади. routing key номи black ёки green бўлганларр Q2 навбатга маршрутланади. Барча бошқа ҳабарлар бекор қиланиди.

